<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KP1HYGJL04"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KP1HYGJL04');
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<title>Enroll Now | Verchas Academy Ayodhya</title>
<meta name="description" content="Enroll at Verchas Academy Ayodhya for NEET, IIT-JEE, CUET and BSc Nursing coaching. Fill the registration form to apply.">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f2f4f8;
}
.container{
  position:relative;
  max-width:700px;
  margin:40px auto;
  background:#ffffff;
  padding:35px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
  overflow:hidden;
}
h1{
  text-align:center;
  font-size:1.5em;
  color:#003366;
  margin-bottom:25px;
}
h3{
  margin-top:25px;
  color:#004aad;
}
input, select, textarea, button{
  width:100%;
  padding:12px;
  margin-top:12px;
  font-size:1em;
}
textarea{resize:none}
button{
  background:#004aad;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:1.1em;
  cursor:pointer;
}
button:hover{
  background:#003366;
}
.note{
  font-size:0.9em;
  color:#555;
  margin-top:6px;
}
/* ---------- Form Header (Logo + Academy Name in one row) ---------- */
.form-header{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
  margin-bottom:10px;
}
.form-header img{
  height:65px;
}

.academy-name{
  font-size:2.4em;   /* DEFINITELY bigger than h1 */
  font-weight:700;
  color:#003366;
}
.container > *{
  position:relative;
  z-index:1;
}
/* ---------- Logo Watermark ---------- */
/* ---------- Logo Watermark (FULL WIDTH) ---------- */
.container::before{
  content:"";
  position:absolute;
  top:50%;
  left:50%;
  width:100%;              /* almost full breadth */
  height:100%;             /* covers most of container */
  background:url("verchas-logo.png") no-repeat center;
  background-size:contain;
  opacity:0.06;           /* adjust if needed */
  transform:translate(-50%, -50%);
  pointer-events:none;
  z-index:0;
}
button:disabled{
  background:#999 !important;
  cursor:not-allowed;
  opacity:0.85;
}
</style>
</head>

<body>

<div class="container">
<!-- Form Header : Logo + Academy Name -->
<div class="form-header">
  <img src="verchas-logo.png" alt="Verchas Academy Logo">
  <h2 class="academy-name">Verchas Academy</h2>
</div>
<h1>Student Registration Form</h1>

<form action="https://script.google.com/macros/s/AKfycbw5mr__udM0mcHRx05QABAZ4QjgL6gtCu_vzpRYJ_xLT8eGKFfXInXHE5Qx4b0ikcqknw/exec" method="POST">

<h3>Student Details</h3>
<input type="text" name="Student Name" placeholder="Student Name" required>
<input type="text" name="Father Name" placeholder="Father's Name" required>
<input
  type="text"
  id="dob"
  name="Date_of_Birth"
  placeholder="Date of Birth (DD/MM/YYYY)"
  maxlength="10"
  required
>
<select name="Gender" required>
  <option value="">Gender</option>
  <option>Male</option>
  <option>Female</option>
  <option>Other</option>
</select>

<input type="text" name="Current School/College" placeholder="Current School / College" required>

<select name="Medium" required>
  <option value="">Medium of Education</option>
  <option>English</option>
  <option>Hindi</option>
</select>

<h3>Contact Information</h3>

<input type="tel" name="Mobile Number" placeholder="Mobile Number" pattern="[0-9]{10}" required>
<input type="tel" name="Emergency Contact Number" placeholder="Emergency Contact Number" pattern="[0-9]{10}" required>
<input type="email" name="Email" placeholder="Email Address">
<textarea name="Address" rows="3" placeholder="Full Address" required></textarea>

<h3>Course Details</h3>
<select name="Course Opted For" required>
  <option value="">Course Opted For</option>
  <option>NEET</option>
  <option>IIT-JEE</option>
  <option>Pre-Foundation (9th‚Äì10th)</option>
  <option>Foundation (11th‚Äì12th)</option>
  <option>Other</option>
</select>

<button type="submit" id="submitBtn">
  <span id="btnText">Submit Registration</span>
  <span id="btnSpinner" style="display:none; margin-left:8px;">‚è≥</span>
</button>

<p id="submitMsg" style="display:none; margin-top:12px; font-weight:600; color:#004aad;">
Please wait‚Ä¶ Submitting your registration.
</p>
<p id="formError" style="color:red; font-weight:600; display:none; margin-top:10px;">
Please check the highlighted fields. Some information is invalid or missing.
</p>

</form>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const dob = document.getElementById("dob");

  dob.addEventListener("input", function (e) {
    let raw = dob.value.replace(/[^0-9]/g, "");

    // limit to DDMMYYYY
    if (raw.length > 8) raw = raw.slice(0, 8);

    // ---------- VALIDATION ----------
    if (raw.length >= 2) {
      const dd = parseInt(raw.slice(0, 2), 10);
      if (dd < 1 || dd > 31) {
        dob.value = "";
        return;
      }
    }

    if (raw.length >= 4) {
      const mm = parseInt(raw.slice(2, 4), 10);
      if (mm < 1 || mm > 12) {
        dob.value = "";
        return;
      }
    }

    if (raw.length === 8) {
      const yyyy = parseInt(raw.slice(4, 8), 10);
      const currentYear = new Date().getFullYear();
      if (yyyy > currentYear) {
        dob.value = "";
        return;
      }
    }

    // ---------- FORCE "/" INSERTION ----------
    let formatted = "";

    if (raw.length <= 2) {
      formatted = raw;
      if (raw.length === 2) formatted += "/";
    } 
    else if (raw.length <= 4) {
      formatted = raw.slice(0, 2) + "/" + raw.slice(2);
      if (raw.length === 4) formatted += "/";
    } 
    else {
      formatted =
        raw.slice(0, 2) + "/" +
        raw.slice(2, 4) + "/" +
        raw.slice(4);
    }

    dob.value = formatted;
  });
});
</script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- QR Code -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const form = document.querySelector("form");

form.addEventListener("submit", async function (e) {
  e.preventDefault();

  if (!form.checkValidity()) {
    document.getElementById("formError").style.display = "block";
    return;
  }

  const submitBtn = document.getElementById("submitBtn");
  const btnText = document.getElementById("btnText");
  const spinner = document.getElementById("btnSpinner");
  const submitMsg = document.getElementById("submitMsg");

  submitBtn.disabled = true;
  btnText.textContent = "Generating Registration Slip‚Ä¶";
  spinner.style.display = "inline";
  submitMsg.style.display = "block";
  submitMsg.textContent = "Please wait‚Ä¶ Generating your Registration Slip.";

  // üîπ Send form data to backend
  const formData = new FormData(form);
  const response = await fetch(form.action, {
    method: "POST",
    body: formData
  });

  if (!response.ok) {
    document.getElementById("formError").style.display = "block";
    submitBtn.disabled = false;
    btnText.textContent = "Submit Registration";
    spinner.style.display = "none";
    submitMsg.style.display = "none";
    return;
  }

  const result = await response.json();

  // üîπ QR Code text (plain readable)
  const qrText =
    "Registration No: " + result.registrationNo + "\n" +
    "Student Name: " + result.studentName + "\n" +
    "Father Name: " + result.fatherName + "\n" +
    "Mobile: " + result.mobile;

  // üîπ Generate QR in memory
  const qrDiv = document.createElement("div");
  new QRCode(qrDiv, {
    text: qrText,
    width: 120,
    height: 120
  });

  await new Promise(r => setTimeout(r, 300));
  const qrImg = qrDiv.querySelector("img");

  // üîπ Generate PDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // üîπ Preload logo as Data URL (mobile-safe)
async function getLogoDataUrl(url) {
  const response = await fetch(url, { cache: "no-store" });
  const blob = await response.blob();
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.readAsDataURL(blob);
  });
}

const logoUrl = "https://verchasacademy.in/verchas-logo.png";
const logoDataUrl = await getLogoDataUrl(logoUrl);

// ================= FULL PAGE WATERMARK =================
doc.saveGraphicsState();
doc.setGState(new doc.GState({ opacity: 0.05 }));
doc.addImage(logoDataUrl, "PNG", 10, 40, 190, 190);
doc.restoreGraphicsState();

// Logo (KEEP AS-IS ‚Äì do not change size)
doc.addImage(logoDataUrl, "PNG", 75, 10, 55, 45);

// Headings
doc.setFontSize(18);
doc.text("VERCHAS ACADEMY", 105, 62, { align: "center" });
doc.setFontSize(14);
doc.text("Student Registration Slip", 105, 72, { align: "center" });
doc.line(20, 78, 190, 78);

// Centre line
doc.setFontSize(12);
doc.text("Centre : Verchas Academy, Saketpuri, Devkali Bypass, Ayodhya", 20, 95);

// Student details
doc.setFontSize(12);
doc.text("Registration No :", 20, 115);
doc.setFontSize(14);
doc.text(result.registrationNo, 65, 115);

doc.setFontSize(12);
doc.text("Student Name :", 20, 125);
doc.text(result.studentName, 65, 125);

doc.text("Father's Name :", 20, 135);
doc.text(result.fatherName, 65, 135);

doc.text("Mobile Number :", 20, 145);
doc.text(result.mobile, 65, 145);

// QR Code
doc.addImage(qrImg.src, "PNG", 150, 115, 35, 35);

// Footer
doc.setFontSize(10);
doc.text("Authorised Signatory", 20, 195);
doc.text("Verchas Academy", 20, 200);
doc.text(
  "Note: Please bring this Student Registration Slip to the Academy Office along with a valid photo ID.",
  20,
  220,
  { maxWidth: 170 }
);

// üîπ Inform user before opening PDF
submitMsg.textContent = "Your Registration Slip is opening‚Ä¶";

// üîπ Open PDF in new tab (mobile-safe)
// Step 1: open a blank window immediately (gesture-safe)
const newWin = window.open("", "_blank");

// Generate PDF blob
const pdfBlob = doc.output("blob");
const pdfUrl = URL.createObjectURL(pdfBlob);

// üîπ Force direct download (no about:blank)
const a = document.createElement("a");
a.href = pdfUrl;
a.download = "RegistrationSlip.pdf";  // filename shown to user
document.body.appendChild(a);
a.click();
document.body.removeChild(a);

// üîπ After download, redirect to thankyou.html
window.location.href = "thankyou.html";

// Reset button
submitBtn.disabled = false;
btnText.textContent = "Submit Registration";
spinner.style.display = "none";
submitMsg.style.display = "none";
});
</script>
</body>
</html>